<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="org.study.mybatis.company.dao.EmployeeMapper">

  <select id="selectEmployee"
    parameterType="int"
    resultMap="EmployeeResultMap">
    SELECT * FROM EMPLOYEE
    WHERE EMPLOYEE_ID = #{employeeId}
  </select>

  <select id="selectEmployeeWithPessimisticLock"
    parameterType="int"
    resultMap="EmployeeResultMap">
    SELECT * FROM EMPLOYEE
    WHERE EMPLOYEE_ID = #{employeeId}
    FOR UPDATE
  </select>

  <insert id="insertEmployee"
    parameterType="org.study.mybatis.company.dto.Employee">
    INSERT INTO EMPLOYEE
    VALUES (#{employeeId},
    #{employeeName:VARCHAR},
    #{departmentName:VARCHAR},
    #{entranceDate:DATE},
    #{jobType:VARCHAR},
    #{salary:NUMERIC},
    #{photo:BLOB},
    #{createTime:TIMESTAMP},
    #{version:NUMERIC})
  </insert>

  <update id="updateEmployee"
    parameterType="org.study.mybatis.company.dto.Employee">
    UPDATE EMPLOYEE
    SET EMPLOYEE_NAME = #{employeeName:VARCHAR},
    DEPARTMENT_NAME = #{departmentName:VARCHAR},
    ENTRANCE_DATE = #{entranceDate:DATE},
    JOB_NAME = #{jobType:VARCHAR},
    SALARY = #{salary:NUMERIC},
    PHOTO = #{photo:BLOB},
    CREATE_TIME = #{createTime:TIMESTAMP},
    VERSION = VERSION + 1
    WHERE EMPLOYEE_ID = #{employeeId}
    AND VERSION = #{version}
  </update>

  <resultMap id="EmployeeResultMap"
    type="org.study.mybatis.company.dto.Employee">
    <result property="jobType" column="JOB_NAME" />
  </resultMap>

</mapper>